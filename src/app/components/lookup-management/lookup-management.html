<div class="page-container">
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Lookup Management</h1>
      <p class="page-subtitle">Manage system lookup tables and reference data</p>
      @if (loading()) {
        <mat-icon class="loading-icon">refresh</mat-icon>
      }
    </div>
  </div>

  <!-- Error Display -->
  @if (error(); as errorMsg) {
    <div class="error-banner">
      <mat-icon>error</mat-icon>
      <span>{{ errorMsg }}</span>
      <button mat-icon-button 
              (click)="clearError()"
              aria-label="Clear error message"
              title="Clear error message">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  }

  <div class="two-panel-container">
    <!-- Left Column - Data List Panel -->
    <div class="left-panel data-list-panel">
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>Lookup Tables</mat-card-title>
        </mat-card-header>
        
        <mat-card-content>
          <!-- Search Bar -->
          <mat-form-field appearance="outline" class="search-field">
            <mat-label>Search lookups...</mat-label>
            <input 
              matInput 
              [(ngModel)]="searchTerm" 
              (ngModelChange)="onSearchChange()"
              placeholder="Search by name, description, or category">
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <!-- Data List -->
          <mat-nav-list class="data-list">
            <mat-list-item 
              *ngFor="let lookup of filteredLookups"
              [class.selected]="selectedLookup()?.id === lookup.id"
              (click)="selectLookup(lookup)">
              <div matListItemTitle>{{ lookup.name }}</div>
              <div matListItemMeta class="data-category">{{ lookup.category }}</div>
            </mat-list-item>
          </mat-nav-list>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Right Column - Data Details Panel -->
    <div class="right-panel data-details-panel">
      <mat-card class="content-card" *ngIf="selectedLookup() as selectedItem">
        <mat-card-header>
          <mat-card-title>{{ selectedItem.name }}</mat-card-title>
          <mat-card-subtitle>{{ selectedItem.description }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <!-- Data Info -->
          <div class="data-info">
            <div class="info-row">
              <span class="info-label">Category:</span>
              <span class="info-value">{{ selectedItem.category }}</span>
            </div>
            <div class="info-row">
              <span class="info-label">Total Values:</span>
              <span class="info-value">{{ selectedItem.values.length }}</span>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="action-buttons">
            <button mat-raised-button class="action-button-primary" (click)="addNewValue()">
              <mat-icon>add</mat-icon>
              Add Value
            </button>
            <button mat-raised-button class="action-button-accent" (click)="saveLookup()">
              <mat-icon>save</mat-icon>
              Save Changes
            </button>
          </div>

          <!-- Data Table -->
          <div class="data-table-container">
            <table mat-table [dataSource]="selectedItem.values" class="data-table">
              <!-- Key Column -->
              <ng-container matColumnDef="key">
                <th mat-header-cell *matHeaderCellDef>Key</th>
                <td mat-cell *matCellDef="let value; let i = index">
                  <mat-form-field appearance="outline" class="table-input">
                    <input matInput [(ngModel)]="value.key" placeholder="Enter key">
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Value Column -->
              <ng-container matColumnDef="value">
                <th mat-header-cell *matHeaderCellDef>Display Value</th>
                <td mat-cell *matCellDef="let value; let i = index">
                  <mat-form-field appearance="outline" class="table-input">
                    <input matInput [(ngModel)]="value.value" placeholder="Enter display value">
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Description Column -->
              <ng-container matColumnDef="description">
                <th mat-header-cell *matHeaderCellDef>Description</th>
                <td mat-cell *matCellDef="let value; let i = index">
                  <mat-form-field appearance="outline" class="table-input">
                    <input matInput [(ngModel)]="value.description" placeholder="Enter description">
                  </mat-form-field>
                </td>
              </ng-container>

              <!-- Active Status Column -->
              <ng-container matColumnDef="isActive">
                <th mat-header-cell *matHeaderCellDef>Active</th>
                <td mat-cell *matCellDef="let value">
                  <button 
                    mat-icon-button 
                    [color]="value.isActive ? 'primary' : ''"
                    (click)="toggleValueStatus(value)"
                    [title]="value.isActive ? 'Active' : 'Inactive'"
                    [aria-label]="'Toggle active status for ' + value.name">
                    <mat-icon>{{ value.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
                  </button>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let value; let i = index">
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="removeValue(i)"
                    title="Remove this value"
                    [aria-label]="'Remove value ' + value.name">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Empty State -->
      <mat-card class="content-card empty-state" *ngIf="!selectedLookup">
        <mat-card-content>
          <div class="empty-content">
            <mat-icon class="empty-icon">table_view</mat-icon>
            <h2>Select a Lookup Table</h2>
            <p>Choose a lookup table from the left panel to view and edit its values.</p>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>
