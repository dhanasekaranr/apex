<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">Application Settings</h1>
    <p class="page-subtitle">Manage application configuration and preferences</p>
  </div>

  <!-- Loading -->
  @if (loading()) {
    <div class="loading-container">
      <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      <p>Loading settings...</p>
    </div>
  }

  <!-- Error -->
  @if (error(); as error) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon>error</mat-icon>
        <span>{{ error }}</span>
      </mat-card-content>
    </mat-card>
  }

  <div class="two-panel-container">
    <!-- Left Panel - Categories -->
    <div class="left-panel data-list-panel">
      <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>Settings Categories</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <nav class="data-list" role="navigation" aria-label="Settings categories">
            <button 
              mat-button 
              (click)="selectCategory('general')" 
              [class.selected]="selectedCategory === 'general'"
              [attr.aria-pressed]="selectedCategory === 'general'"
              class="category-button">
              <div class="category-content">
                <span class="category-title">General Settings</span>
                <span class="data-category">App</span>
              </div>
            </button>
            <button 
              mat-button 
              (click)="selectCategory('preferences')" 
              [class.selected]="selectedCategory === 'preferences'"
              [attr.aria-pressed]="selectedCategory === 'preferences'"
              class="category-button">
              <div class="category-content">
                <span class="category-title">User Preferences</span>
                <span class="data-category">User</span>
              </div>
            </button>
            <button 
              mat-button 
              (click)="selectCategory('security')" 
              [class.selected]="selectedCategory === 'security'"
              [attr.aria-pressed]="selectedCategory === 'security'"
              class="category-button">
              <div class="category-content">
                <span class="category-title">Security Settings</span>
                <span class="data-category">Security</span>
              </div>
            </button>
            <button 
              mat-button 
              (click)="selectCategory('system')" 
              [class.selected]="selectedCategory === 'system'"
              [attr.aria-pressed]="selectedCategory === 'system'"
              class="category-button">
              <div class="category-content">
                <span class="category-title">System Information</span>
                <span class="data-category">Info</span>
              </div>
            </button>
          </nav>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Right Panel - Content -->
    <div class="right-panel data-details-panel">
      
      <!-- General Settings -->
      @if (selectedCategory === 'general') {
        <mat-card class="content-card">
          <mat-card-header>
            <mat-card-title>General Settings</mat-card-title>
            <mat-card-subtitle>Configure basic application settings</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <form [formGroup]="generalForm" class="data-form">
              <mat-form-field appearance="outline">
                <mat-label>Application Name</mat-label>
                <input matInput formControlName="applicationName">
              </mat-form-field>
              
              <mat-form-field appearance="outline">
                <mat-label>Default Language</mat-label>
                <mat-select formControlName="defaultLanguage">
                  @for (lang of languageOptions; track lang.value) {
                    <mat-option [value]="lang.value">
                      {{ lang.label }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            
            <mat-form-field appearance="outline">
              <mat-label>Company Name</mat-label>
              <input matInput formControlName="companyName">
            </mat-form-field>

            <mat-form-field appearance="outline">
              <mat-label>Support Email</mat-label>
              <input matInput type="email" formControlName="supportEmail">
            </mat-form-field>
          </form>
          
            <div class="action-bar">
              <button mat-raised-button class="action-button-primary" (click)="saveGeneralSettings()">
                <mat-icon>save</mat-icon>
                Save General Settings
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- User Preferences -->
      @if (selectedCategory === 'preferences') {
        <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>User Preferences</mat-card-title>
          <mat-card-subtitle>Customize your experience</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
            <form [formGroup]="userPreferencesForm" class="data-form">
              <mat-form-field appearance="outline">
                <mat-label>Theme</mat-label>
                <mat-select formControlName="theme">
                  @for (theme of themeOptions; track theme.value) {
                    <mat-option [value]="theme.value">
                      {{ theme.label }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Font Size</mat-label>
                <mat-select formControlName="fontSize">
                  <mat-option value="small">Small</mat-option>
                  <mat-option value="medium">Medium</mat-option>
                  <mat-option value="large">Large</mat-option>
                </mat-select>
              </mat-form-field>

              <div class="checkbox-group">
                <mat-slide-toggle formControlName="compactMode">Compact Mode</mat-slide-toggle>
                <mat-slide-toggle formControlName="autoSave">Auto Save</mat-slide-toggle>
              </div>
            </form>
            
            <div class="action-bar">
              <button mat-raised-button class="action-button-primary" (click)="saveUserPreferences()">
                <mat-icon>save</mat-icon>
                Save Preferences
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- Security Settings -->
      @if (selectedCategory === 'security') {
        <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>Security Settings</mat-card-title>
          <mat-card-subtitle>Configure security and authentication</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <form [formGroup]="securityForm" class="data-form">
            <mat-form-field appearance="outline">
              <mat-label>Session Timeout (minutes)</mat-label>
              <input matInput type="number" formControlName="sessionTimeout">
            </mat-form-field>

            <div class="checkbox-group">
              <mat-slide-toggle formControlName="twoFactorEnabled">Enable Two-Factor Authentication</mat-slide-toggle>
              <mat-slide-toggle formControlName="rememberMe">Remember Me Option</mat-slide-toggle>
            </div>
          </form>
          
            <div class="action-bar">
              <button mat-raised-button class="action-button-primary" (click)="saveSecuritySettings()">
                <mat-icon>save</mat-icon>
                Save Security Settings
              </button>
            </div>
          </mat-card-content>
        </mat-card>
      }

      <!-- System Information -->
      @if (selectedCategory === 'system') {
        <mat-card class="content-card">
        <mat-card-header>
          <mat-card-title>System Information</mat-card-title>
          <mat-card-subtitle>View system status and performance</mat-card-subtitle>
        </mat-card-header>
          <mat-card-content>
            @if (systemInformation(); as system) {
              <div>
                <h2>Server Information</h2>
                <p><strong>Hostname:</strong> {{ system.server.hostname || 'N/A' }}</p>
                <p><strong>Status:</strong> {{ system.database.status || 'N/A' }}</p>
                
                <h2>Performance</h2>
                <p><strong>CPU Usage:</strong> {{ system.performance.cpuUsage || 0 }}%</p>
                <p><strong>Memory Usage:</strong> {{ system.performance.memoryUsage || 0 }}%</p>
              </div>
            }
          </mat-card-content>
        </mat-card>
      }

      <!-- Default Message -->
      @if (!selectedCategory) {
        <mat-card class="content-card">
          <mat-card-content class="empty-state">
            <mat-icon class="empty-icon">settings</mat-icon>
            <h2>Select a Settings Category</h2>
            <p>Choose a category from the left panel to view and configure settings.</p>
          </mat-card-content>
        </mat-card>
      }

    </div>
  </div>
</div>
